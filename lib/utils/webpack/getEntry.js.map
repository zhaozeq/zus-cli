{"version":3,"sources":["../../../src/utils/webpack/getEntry.js"],"names":["opts","cwd","entry","isBuild","entryObj","index","getExistsDefaultEntry","files","getFiles","getEntries","Array","isArray","reduce","memo","entryItem","concat","isPlainObject","Error","Object","keys","key","webpackHotDevClientPath","setPublicPathFile","__dirname","process","env","SET_PUBLIC_PATH","getEntry","filePath","replace","glob","sync","map","file","charAt","sep","obj","proto","getPrototypeOf"],"mappings":"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","sourcesContent":["import { join, basename, sep } from 'path'\nimport { existsSync } from 'fs'\nimport glob from 'glob'\nimport { webpackHotDevClientPath } from './reactDevUtils'\n\n// entry 支持 4 种格式：\n//\n// 1. 什么都没配，取 src/index.(j|t)sx?\n// 2. 对象\n// 3. 字符串\n// 4. 数组\nexport default function(opts = {}) {\n  const { cwd, entry, isBuild } = opts\n\n  let entryObj = null\n  if (!entry) {\n    entryObj = {\n      index: getExistsDefaultEntry(cwd)\n    }\n  } else if (typeof entry === 'string') {\n    const files = getFiles(entry, cwd)\n    entryObj = getEntries(files)\n  } else if (Array.isArray(entry)) {\n    const files = entry.reduce((memo, entryItem) => {\n      return memo.concat(getFiles(entryItem, cwd))\n    }, [])\n    entryObj = getEntries(files)\n  } else if (isPlainObject(entry)) {\n    entryObj = entry\n  } else {\n    throw new Error(\n      `entry should be String, Array or Plain Object, but got ${entry}`\n    )\n  }\n\n  if (!isBuild) {\n    entryObj = Object.keys(entryObj).reduce(\n      (memo, key) =>\n        !Array.isArray(entryObj[key])\n          ? {\n              ...memo,\n              [key]: [webpackHotDevClientPath, entryObj[key]]\n            }\n          : {\n              ...memo,\n              [key]: entryObj[key]\n            },\n      {}\n    )\n  }\n\n  // add setPublicPath\n  const setPublicPathFile = join(__dirname, '../../template/setPublicPath.js')\n  if (process.env.SET_PUBLIC_PATH) {\n    entryObj = Object.keys(entryObj).reduce((memo, key) => {\n      return {\n        ...memo,\n        [key]: [\n          setPublicPathFile,\n          ...(Array.isArray(entryObj[key]) ? entryObj[key] : [entryObj[key]])\n        ]\n      }\n    }, {})\n  }\n\n  return entryObj\n}\n\nfunction getEntry(filePath) {\n  const key = basename(filePath).replace(/\\.(j|t)sx?$/, '')\n  return {\n    [key]: filePath\n  }\n}\n\nfunction getFiles(entry, cwd) {\n  const files = glob.sync(entry, {\n    cwd\n  })\n  return files.map(file => {\n    return file.charAt(0) === '.' ? file : `.${sep}${file}`\n  })\n}\n\nfunction getEntries(files) {\n  return files.reduce((memo, file) => {\n    return {\n      ...memo,\n      ...getEntry(file)\n    }\n  }, {})\n}\n\nfunction getExistsDefaultEntry(cwd) {\n  if (existsSync(join(cwd, './src/index.js'))) {\n    return './src/index.js'\n  }\n  if (existsSync(join(cwd, './src/index.jsx'))) {\n    return './src/index.jsx'\n  }\n  if (existsSync(join(cwd, './src/index.ts'))) {\n    return './src/index.ts'\n  }\n  if (existsSync(join(cwd, './src/index.tsx'))) {\n    return './src/index.tsx'\n  }\n  // default\n  return './src/index.js'\n}\n\nfunction isPlainObject(obj) {\n  if (typeof obj !== 'object' || obj === null) return false\n  let proto = obj\n\n  while (Object.getPrototypeOf(proto) !== null) {\n    proto = Object.getPrototypeOf(proto)\n  }\n\n  return Object.getPrototypeOf(obj) === proto\n}\n"],"file":"getEntry.js"}