{"version":3,"sources":["../../../src/utils/babel/babel.js"],"names":["context","opts","presets","getBabel","getBabelRc","cwd","file","rcFile","config","plugins","JSON","parse","Array","nodeEnv","process","env","NODE_ENV","useBuiltIns","loose","targets","browsers","transformRuntime","absoluteRuntime","ZUS_DIR","exclude","require","resolve","legacy","proposal","push","userConfig","modules"],"mappings":"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","sourcesContent":["import { existsSync, readFileSync } from 'fs';\nimport stripJsonComments from 'strip-json-comments';\nimport { resolve } from 'path';\n\nexport default function(context, opts = {}) {\n  return {\n    presets: [[getBabel(opts)]],\n  };\n}\n\nfunction getBabelRc({ cwd, file = 'babelrc' }) {\n  const rcFile = resolve(cwd, file);\n  let config = {\n    presets: [],\n    plugins: [],\n  };\n  if (existsSync(rcFile)) {\n    config = JSON.parse(stripJsonComments(readFileSync(rcFile, 'utf-8')));\n  }\n  if (!(config.presets instanceof Array)) {\n    config.presets = [];\n  }\n  if (!(config.plugins instanceof Array)) {\n    config.plugins = [];\n  }\n  return config;\n}\n/**\n * babel plugins\n *\n * @export\n * @param {*} context\n * @param {*} [opts={}]\n * @returns\n */\nfunction getBabel(opts = {}) {\n  // console.log(context, 'context')\n  const nodeEnv = process.env.NODE_ENV;\n  const {\n    /**\n     *  \"usage\"：在每个文件中使用polyfill时导入\n     *  \"entry\"：只在入口引入(\"@babel/polyfill\")\n     *  false(默认): 不做上述两个操作\n     */\n    useBuiltIns = false,\n    loose = false, // 是否允许松散装换\n    targets = { browsers: ['last 2 versions'] },\n    cwd = process.cwd(),\n    env = {},\n  } = opts;\n  const transformRuntime = 'transformRuntime' in opts\n      ? opts.transformRuntime\n      : {\n          absoluteRuntime: process.env.ZUS_DIR,\n        };\n  const exclude = [\n    'transform-typeof-symbol',\n    'transform-unicode-regex',\n    'transform-sticky-regex',\n    'transform-new-target',\n    'transform-modules-umd',\n    'transform-modules-systemjs',\n    'transform-modules-amd',\n    'transform-literals',\n  ];\n\n  const plugins = [\n    require.resolve('babel-plugin-react-require'), // 不用 require react\n    require.resolve('@babel/plugin-syntax-dynamic-import'),\n    [require.resolve('@babel/plugin-proposal-object-rest-spread'), { loose, useBuiltIns }],\n    require.resolve('@babel/plugin-proposal-optional-catch-binding'),\n    require.resolve('@babel/plugin-proposal-async-generator-functions'),\n\n    // 下面两个的顺序的配置都不能动\n    [require.resolve('@babel/plugin-proposal-decorators'), { legacy: true }],\n    [require.resolve('@babel/plugin-proposal-class-properties'), { loose: true }],\n\n    require.resolve('@babel/plugin-proposal-export-namespace-from'),\n    require.resolve('@babel/plugin-proposal-export-default-from'),\n    [require.resolve('@babel/plugin-proposal-nullish-coalescing-operator'), { loose }],\n    [require.resolve('@babel/plugin-proposal-optional-chaining'), { loose }],\n    [\n      require.resolve('@babel/plugin-proposal-pipeline-operator'),\n      {\n        proposal: 'minimal',\n      },\n    ],\n    require.resolve('@babel/plugin-proposal-do-expressions'),\n    require.resolve('@babel/plugin-proposal-function-bind'),\n    require.resolve('babel-plugin-macros'),\n  ];\n\n  if (nodeEnv !== 'test' && transformRuntime) {\n    plugins.push([require.resolve('@babel/plugin-transform-runtime'), transformRuntime]);\n  }\n  if (nodeEnv === 'production') {\n    plugins.push(require.resolve('babel-plugin-transform-react-remove-prop-types'));\n  }\n  const userConfig = getBabelRc({ cwd, file: '.babelrc' });\n  return {\n    presets: [\n      [\n        require.resolve('@babel/preset-env'),\n        {\n          targets,\n          loose,\n          modules: 'commonjs',\n          exclude,\n          ...env,\n        },\n      ],\n      require.resolve('@babel/preset-react'),\n      ...userConfig.presets,\n    ],\n    plugins: [...plugins, ...userConfig.plugins],\n  };\n}\n"],"file":"babel.js"}