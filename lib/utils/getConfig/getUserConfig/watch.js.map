{"version":3,"sources":["../../../../src/utils/getConfig/getUserConfig/watch.js"],"names":["watchers","watch","key","files","process","env","WATCH_FILES","watcher","chokidar","ignoreInitial","push","unwatch","Object","keys","forEach","close"],"mappings":";;;;;;;;;;AAAA;;AAEA;AACA,IAAMA,QAAQ,GAAG,EAAjB;;AAEO,SAASC,KAAT,CAAeC,GAAf,EAAoBC,KAApB,EAA2B;AAChC,MAAIC,OAAO,CAACC,GAAR,CAAYC,WAAZ,KAA4B,MAAhC,EAAwC;;AACxC,MAAI,CAACN,QAAQ,CAACE,GAAD,CAAb,EAAoB;AAClBF,IAAAA,QAAQ,CAACE,GAAD,CAAR,GAAgB,EAAhB;AACD;;AACD,MAAMK,OAAO,GAAGC,qBAASP,KAAT,CAAeE,KAAf,EAAsB;AACpCM,IAAAA,aAAa,EAAE;AADqB,GAAtB,CAAhB;;AAGAT,EAAAA,QAAQ,CAACE,GAAD,CAAR,CAAcQ,IAAd,CAAmBH,OAAnB;AACA,SAAOA,OAAP;AACD;;AAEM,SAASI,OAAT,CAAiBT,GAAjB,EAAsB;AAC3B,MAAI,CAACA,GAAL,EAAU;AACR,WAAOU,MAAM,CAACC,IAAP,CAAYb,QAAZ,EAAsBc,OAAtB,CAA8BH,OAA9B,CAAP;AACD;;AACD,MAAIX,QAAQ,CAACE,GAAD,CAAZ,EAAmB;AACjBF,IAAAA,QAAQ,CAACE,GAAD,CAAR,CAAcY,OAAd,CAAsB,UAAAP,OAAO,EAAI;AAC/BA,MAAAA,OAAO,CAACQ,KAAR;AACD,KAFD;AAGA,WAAOf,QAAQ,CAACE,GAAD,CAAf;AACD;AACF","sourcesContent":["import chokidar from 'chokidar';\n\n// 按 key 存，值为数组\nconst watchers = {};\n\nexport function watch(key, files) {\n  if (process.env.WATCH_FILES === 'none') return;\n  if (!watchers[key]) {\n    watchers[key] = [];\n  }\n  const watcher = chokidar.watch(files, {\n    ignoreInitial: true,\n  });\n  watchers[key].push(watcher);\n  return watcher;\n}\n\nexport function unwatch(key) {\n  if (!key) {\n    return Object.keys(watchers).forEach(unwatch);\n  }\n  if (watchers[key]) {\n    watchers[key].forEach(watcher => {\n      watcher.close();\n    });\n    delete watchers[key];\n  }\n}\n"],"file":"watch.js"}